<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Coordinate Cella Elementare 3D - Affiancate</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        canvas { display: block; }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- SETUP SCENA ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000); // Sfondo Nero

        // Asse Z verticale
        scene.up.set(0, 0, 1);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        // Posizione camera modificata per vedere la disposizione orizzontale
        camera.position.set(2, -12, 6);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        // Target spostato leggermente a destra per centrare visivamente i tre oggetti
        controls.target.set(2, 0, 0.5); 

        // --- LUCI ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(10, -10, 15);
        scene.add(dirLight);

        // --- FUNZIONI UTILI ---

        // Helper generico per creare etichette di testo
        function createTextLabel(text, position, colorString = "#ffffff", scale = 1) {
            const canvas = document.createElement('canvas');
            const size = 512; // Risoluzione aumentata per testo più nitido
            canvas.width = size;
            canvas.height = size;
            const context = canvas.getContext('2d');
            context.font = 'Bold 100px Arial';
            context.fillStyle = colorString;
            context.textAlign = "center";
            context.textBaseline = "middle";
            context.fillText(text, size / 2, size / 2);

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(material);
            sprite.position.copy(position);
            sprite.scale.set(scale, scale, scale);
            return sprite;
        }


        function createUnitCellWireframe() {
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            geometry.translate(0.5, 0.5, 0.5); 
            const edges = new THREE.EdgesGeometry(geometry);
            // Spigoli leggermente più grigi per far risaltare le etichette bianche
            const material = new THREE.LineBasicMaterial({ color: 0xaaaaaa, linewidth: 2 });
            return new THREE.LineSegments(edges, material);
        }

        // Aggiunge le etichette a, b, c sugli spigoli
        function createEdgeLabels() {
            const group = new THREE.Group();
            const scale = 0.8;
            // Etichetta 'a' lungo asse X, leggermente spostata
            group.add(createTextLabel("a", new THREE.Vector3(0.5, -0.15, 0), "#ffffff", scale));
            // Etichetta 'b' lungo asse Y
            group.add(createTextLabel("b", new THREE.Vector3(-0.15, 0.5, 0), "#ffffff", scale));
            // Etichetta 'c' lungo asse Z
            group.add(createTextLabel("c", new THREE.Vector3(-0.15, 0, 0.5), "#ffffff", scale));
            return group;
        }

        // Crea gli assi locali e le etichette x, y, z
        function createLocalAxesAndLabels(length = 0.7) {
            const axesGroup = new THREE.Group();
            const origin = new THREE.Vector3(0, 0, 0);
            
            // X (rosso)
            const dirX = new THREE.Vector3(1, 0, 0);
            axesGroup.add(new THREE.ArrowHelper(dirX, origin, length, 0xff0000, 0.2, 0.1));
            axesGroup.add(createTextLabel("x", new THREE.Vector3(length + 0.2, 0, 0), "#ffffff", 0.8));
            
            // Y (verde)
            const dirY = new THREE.Vector3(0, 1, 0);
            axesGroup.add(new THREE.ArrowHelper(dirY, origin, length, 0x00ff00, 0.2, 0.1));
            axesGroup.add(createTextLabel("y", new THREE.Vector3(0, length + 0.2, 0), "#ffffff", 0.8));
            
            // Z (blu)
            const dirZ = new THREE.Vector3(0, 0, 1);
            axesGroup.add(new THREE.ArrowHelper(dirZ, origin, length, 0x0088ff, 0.2, 0.1));
            axesGroup.add(createTextLabel("z", new THREE.Vector3(0, 0, length + 0.2), "#ffffff", 0.8));

            return axesGroup;
        }

        function createAtom(x, y, z, colorHex) {
            const geometry = new THREE.SphereGeometry(0.08, 32, 32);
            const material = new THREE.MeshPhongMaterial({ color: colorHex });
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.set(x, y, z);
            return sphere;
        }

        // --- CREAZIONE SCENA (3 CASI ORIZZONTALI) ---

        // Distanza orizzontale tra i modelli
        const spacing = 4.0;

        // --- GRUPPO 1 (Sinistra): Coordinate (1/2, 1, 0) ---
        const group1 = new THREE.Group();
        group1.position.set(-spacing, 0, 0); 
        
        group1.add(createUnitCellWireframe());
        group1.add(createEdgeLabels());
        group1.add(createLocalAxesAndLabels());
        group1.add(createAtom(0.5, 1, 0, 0xff3300)); // Punto Rosso
        // Etichetta coordinate specifica
        group1.add(createTextLabel("1/2, 1, 0", new THREE.Vector3(0.5, 1.3, 0), "#ff3300", 1.2));
        
        scene.add(group1);

        // --- GRUPPO 2 (Centro): Coordinate (1, 1, 1) ---
        const group2 = new THREE.Group();
        group2.position.set(0, 0, 0); 
        
        group2.add(createUnitCellWireframe());
        group2.add(createEdgeLabels());
        group2.add(createLocalAxesAndLabels());
        group2.add(createAtom(1, 1, 1, 0xffaa00)); // Punto Arancione
        group2.add(createTextLabel("1, 1, 1", new THREE.Vector3(1, 1.3, 1), "#ffaa00", 1.2));

        scene.add(group2);

        // --- GRUPPO 3 (Destra): Coordinate (0, -1, 0) ---
        const group3 = new THREE.Group();
        group3.position.set(spacing, 0, 0); 
        
        group3.add(createUnitCellWireframe());
        group3.add(createEdgeLabels());
        group3.add(createLocalAxesAndLabels());
        
        // Punto esterno
        group3.add(createAtom(0, -1, 0, 0x0088ff)); // Punto Azzurro
        group3.add(createTextLabel("0, -1, 0", new THREE.Vector3(0, -1.3, 0), "#0088ff", 1.2));

        // Linea tratteggiata
        const lineGeo = new THREE.BufferGeometry().setFromPoints([
            new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, -1, 0)
        ]);
        const lineMat = new THREE.LineDashedMaterial({ color: 0x0088ff, dashSize: 0.1, gapSize: 0.05 });
        const dashLine = new THREE.Line(lineGeo, lineMat);
        dashLine.computeLineDistances(); 
        group3.add(dashLine);

        scene.add(group3);


        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', onWindowResize, false);
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>
</html>
